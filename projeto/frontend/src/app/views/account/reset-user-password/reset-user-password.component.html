<div class="auth-container">
  <div class="auth-card fade-in">
    <div class="auth-header">
      <img src="img/png/logo-foodcare.png" alt="Logo FoodCare" class="brand-logo">
      <h1 class="auth-title">Alterar Senha</h1>
      <p class="auth-subtitle">Digite sua senha atual para continuar</p>
    </div>

    <form class="auth-form" [formGroup]="resetForm">
      @if (!showNewPasswordFields) {
      <div class="form-step">
        <div class="form-group">
          <mat-form-field appearance="outline" class="full-width">
            <mat-label>Senha Atual</mat-label>
            <input matInput 
                   type="password" 
                   placeholder="Digite sua senha atual" 
                   formControlName="oldPassword">
            <mat-icon matPrefix>lock</mat-icon>
            @if (resetForm.controls['oldPassword'].hasError('required')) {
            <mat-error>
              Campo obrigatório
            </mat-error>
            }
          </mat-form-field>
        </div>

        @if (isOldPasswordInvalid) {
        <div class="error-message">
          <mat-icon>error</mat-icon>
          <span>Senha atual incorreta</span>
        </div>
        }

        <div class="form-actions">
          <button type="button" 
                  class="btn btn-primary" 
                  (click)="checkOldPassword()" 
                  [disabled]="!resetForm.controls['oldPassword'].valid">
            <mat-icon>arrow_forward</mat-icon>
            Próximo
          </button>
          
          <button type="button" 
                  class="btn btn-secondary" 
                  routerLink="/main">
            <mat-icon>arrow_back</mat-icon>
            Cancelar
          </button>
        </div>
      </div>
      }

      @if (showNewPasswordFields) {
      <div class="form-step">
        <div class="step-info">
          <div class="success-icon">
            <mat-icon>check_circle</mat-icon>
          </div>
          <p>Senha confirmada! Agora defina sua nova senha.</p>
        </div>

        <div class="form-group">
          <mat-form-field appearance="outline" class="full-width">
            <mat-label>Nova Senha</mat-label>
            <input matInput 
                   type="password" 
                   placeholder="Digite sua nova senha" 
                   formControlName="newPassword">
            <mat-icon matPrefix>lock</mat-icon>
            @if (resetForm.controls['newPassword'].hasError('required')) {
            <mat-error>
              Campo obrigatório
            </mat-error>
            }
            @if (resetForm.controls['newPassword'].hasError('minlength')) {
            <mat-error>
              Senha deve ter no mínimo 6 caracteres
            </mat-error>
            }
            @if (resetForm.controls['newPassword'].hasError('maxlength')) {
            <mat-error>
              Senha deve ter no máximo 18 caracteres
            </mat-error>
            }
          </mat-form-field>
        </div>

        <div class="form-group">
          <mat-form-field appearance="outline" class="full-width">
            <mat-label>Confirmar Nova Senha</mat-label>
            <input matInput 
                   type="password" 
                   placeholder="Confirme sua nova senha" 
                   formControlName="confirmPassword">
            <mat-icon matPrefix>lock_outline</mat-icon>
            @if (resetForm.controls['confirmPassword'].hasError('required')) {
            <mat-error>
              Campo obrigatório
            </mat-error>
            }
          </mat-form-field>
        </div>

        @if (passwordMismatch) {
        <div class="error-message">
          <mat-icon>error</mat-icon>
          <span>As senhas não coincidem</span>
        </div>
        }

        <div class="form-actions">
          <button type="button" 
                  class="btn btn-success" 
                  (click)="savePassword()"
                  [disabled]="!resetForm.valid || !arePasswordsMatching()">
            <mat-icon>save</mat-icon>
            Salvar Senha
          </button>
          
          <button type="button" 
                  class="btn btn-secondary" 
                  (click)="showNewPasswordFields = false; isOldPasswordInvalid = false">
            <mat-icon>arrow_back</mat-icon>
            Voltar
          </button>
        </div>
      </div>
      }
    </form>
  </div>
</div>